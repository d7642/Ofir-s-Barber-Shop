<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>OFIR MASTER BARBER</title>
    
    <link rel="manifest" href="data:application/manifest+json,{'name':'OfirBarber','short_name':'Ofir','start_url':'.','display':'standalone','background_color':'#0f0f10','theme_color':'#C6A87C'}">

    <style>
        :root {
            --bg-dark: #0f0f10;
            --card-dark: #1a1a1c;
            --gold: #C6A87C;
            --gold-glow: rgba(198, 168, 124, 0.3);
            --text-main: #ffffff;
            --text-muted: #888888;
            --border-color: #333;
            --success: #28a745;
            --danger: #dc3545;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; font-family: 'Segoe UI', system-ui, sans-serif; }

        body {
            background-color: var(--bg-dark);
            color: var(--text-main);
            margin: 0;
            padding-bottom: env(safe-area-inset-bottom);
            overflow-x: hidden;
        }

        /* --- Header & Logo --- */
        header {
            padding: 20px;
            text-align: center;
            background: rgba(0,0,0,0.8);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid var(--border-color);
            position: sticky; top: 0; z-index: 1000;
        }

        .brand-name { font-family: serif; font-size: 1.8rem; letter-spacing: 3px; margin: 0; color: #fff; }
        .brand-sub { font-size: 0.7rem; color: var(--gold); letter-spacing: 4px; text-transform: uppercase; }

        /* --- Calendar Section --- */
        .calendar-strip {
            background: var(--card-dark);
            padding: 15px;
            margin-bottom: 10px;
            display: flex;
            flex-direction: column;
            align-items: center;
            border-bottom: 1px solid var(--border-color);
        }

        .calendar-header {
            display: flex; align-items: center; gap: 20px; margin-bottom: 10px; width: 100%; justify-content: space-between;
        }

        #currentMonthDisplay { font-weight: bold; color: var(--gold); font-size: 1.1rem; }

        input[type="date"] {
            background: #222; color: #fff; border: 1px solid var(--gold);
            padding: 8px; border-radius: 8px; font-size: 1rem;
        }

        /* --- Stats Bar --- */
        .stats-bar {
            display: flex; justify-content: space-around; padding: 10px; font-size: 0.8rem; color: var(--text-muted);
        }

        /* --- Slots Section --- */
        .schedule-container { padding: 10px; max-width: 600px; margin: 0 auto; }

        .slot-card {
            background: var(--card-dark);
            border-radius: 15px;
            margin-bottom: 12px;
            padding: 12px;
            display: flex;
            flex-direction: column;
            border-right: 4px solid #333;
            transition: 0.3s;
        }

        .slot-card.has-client { border-right-color: var(--gold); }
        .slot-card.completed { border-right-color: var(--success); opacity: 0.7; }

        .slot-top { display: flex; align-items: center; gap: 12px; margin-bottom: 8px; }
        .slot-time { font-weight: 800; color: var(--gold); font-size: 1.1rem; min-width: 55px; }

        .inputs-area { flex-grow: 1; display: flex; flex-direction: column; gap: 5px; }
        
        .input-name, .input-phone {
            background: transparent; border: none; color: #fff; font-size: 1rem; width: 100%;
            padding: 4px 0; border-bottom: 1px solid transparent;
        }
        .input-name:focus, .input-phone:focus { border-bottom-color: var(--gold); outline: none; }
        .input-phone { font-size: 0.85rem; color: var(--text-muted); }

        .actions { display: flex; gap: 10px; align-items: center; }
        .btn-action {
            background: #252527; border: 1px solid #333; color: var(--gold);
            width: 38px; height: 38px; border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            font-size: 1.1rem; cursor: pointer;
        }

        /* --- Settings Modal --- */
        #settingsModal {
            position: fixed; inset: 0; background: rgba(0,0,0,0.9);
            display: none; z-index: 2000; padding: 40px 20px;
        }

        .modal-content { background: var(--card-dark); padding: 20px; border-radius: 20px; border: 1px solid var(--gold); }

        /* --- Footer Menu --- */
        .bottom-nav {
            position: fixed; bottom: 0; left: 0; right: 0;
            background: rgba(20,20,22,0.95); backdrop-filter: blur(15px);
            display: flex; justify-content: space-around; padding: 12px;
            border-top: 1px solid var(--border-color);
        }

        .nav-item { color: var(--text-muted); text-align: center; font-size: 0.7rem; cursor: pointer; }
        .nav-item.active { color: var(--gold); }

        #toast {
            position: fixed; bottom: 80px; left: 50%; transform: translateX(-50%);
            background: var(--gold); color: #000; padding: 10px 25px;
            border-radius: 20px; font-weight: bold; display: none; z-index: 3000;
        }
    </style>
</head>
<body>

    <header>
        <h1 class="brand-name">OFIR</h1>
        <div class="brand-sub">Master Barber</div>
    </header>

    <div class="calendar-strip">
        <div class="calendar-header">
            <button class="btn-action" onclick="changeDate(-1)">â®</button>
            <div id="currentMonthDisplay">×˜×•×¢×Ÿ...</div>
            <button class="btn-action" onclick="changeDate(1)">â¯</button>
        </div>
        <input type="date" id="datePicker" onchange="jumpToDate(this.value)">
    </div>

    <div class="stats-bar">
        <span id="stat-total">×ª×•×¨×™×: 0</span>
        <span id="stat-done">×‘×•×¦×¢×•: 0</span>
    </div>

    <div class="schedule-container" id="schedule">
        </div>

    <div class="bottom-nav">
        <div class="nav-item active" onclick="location.reload()">ğŸ <br>×‘×™×ª</div>
        <div class="nav-item" onclick="toggleSettings(true)">âš™ï¸<br>×”×’×“×¨×•×ª</div>
        <div class="nav-item" onclick="exportData()">ğŸ’¾<br>×’×™×‘×•×™</div>
    </div>

    <div id="settingsModal">
        <div class="modal-content">
            <h3>×”×’×“×¨×•×ª ×¢×‘×•×“×”</h3>
            <label>×©×¢×ª ×”×ª×—×œ×”:</label>
            <input type="number" id="setStart" value="9" min="0" max="23"><br><br>
            <label>×©×¢×ª ×¡×™×•×:</label>
            <input type="number" id="setEnd" value="23" min="0" max="23"><br><br>
            <button onclick="saveSettings()" style="background:var(--gold); border:none; padding:10px; width:100%; border-radius:10px; font-weight:bold;">×©××•×¨ ×©×™× ×•×™×™×</button>
            <button onclick="toggleSettings(false)" style="background:transparent; color:#fff; border:none; padding:10px; width:100%; margin-top:10px;">×‘×™×˜×•×œ</button>
        </div>
    </div>

    <div id="toast">× ×©××¨ ×‘×”×¦×œ×—×”!</div>

    <script>
        let currentDate = new Date();
        const DB_PREFIX = "ofir_pro_";
        const SETTINGS_KEY = "ofir_settings";

        // Load Settings
        let config = JSON.parse(localStorage.getItem(SETTINGS_KEY)) || { start: 9, end: 24 };

        document.addEventListener('DOMContentLoaded', () => {
            initApp();
        });

        function initApp() {
            updateDateUI();
            renderSchedule();
        }

        function updateDateUI() {
            const options = { weekday: 'long', day: 'numeric', month: 'long' };
            document.getElementById('currentMonthDisplay').innerText = currentDate.toLocaleDateString('he-IL', options);
            const yyyy = currentDate.getFullYear();
            const mm = String(currentDate.getMonth() + 1).padStart(2, '0');
            const dd = String(currentDate.getDate()).padStart(2, '0');
            document.getElementById('datePicker').value = `${yyyy}-${mm}-${dd}`;
        }

        function renderSchedule() {
            const container = document.getElementById('schedule');
            container.innerHTML = '';
            const dayKey = getDayKey();
            const dayData = JSON.parse(localStorage.getItem(dayKey)) || {};
            
            let total = 0, done = 0;

            for (let h = config.start; h < config.end; h++) {
                for (let m of ['00', '15', '30', '45']) {
                    const time = `${String(h).padStart(2,'0')}:${m}`;
                    const entry = dayData[time] || { name: '', phone: '', status: 'pending' };
                    
                    if(entry.name) total++;
                    if(entry.status === 'done') done++;

                    const card = document.createElement('div');
                    card.className = `slot-card ${entry.name ? 'has-client' : ''} ${entry.status === 'done' ? 'completed' : ''}`;
                    card.innerHTML = `
                        <div class="slot-top">
                            <div class="slot-time">${time}</div>
                            <div class="inputs-area">
                                <input type="text" class="input-name" placeholder="×©× ×œ×§×•×—" value="${entry.name}" onchange="saveSlot('${time}', 'name', this.value)">
                                <input type="tel" class="input-phone" placeholder="××¡×¤×¨ ×˜×œ×¤×•×Ÿ" value="${entry.phone}" onchange="saveSlot('${time}', 'phone', this.value)">
                            </div>
                            <div class="actions">
                                <button class="btn-action" onclick="pickContact('${time}')">ğŸ‘¤</button>
                                ${entry.phone ? `<button class="btn-action" onclick="openWhatsApp('${time}', '${entry.name}', '${entry.phone}')">ğŸ’¬</button>` : ''}
                                <button class="btn-action" onclick="toggleStatus('${time}')">${entry.status === 'done' ? 'âœ…' : 'âœ‚'}</button>
                            </div>
                        </div>
                    `;
                    container.appendChild(card);
                }
            }
            document.getElementById('stat-total').innerText = `×ª×•×¨×™×: ${total}`;
            document.getElementById('stat-done').innerText = `×‘×•×¦×¢×•: ${done}`;
        }

        function saveSlot(time, field, value) {
            const key = getDayKey();
            let data = JSON.parse(localStorage.getItem(key)) || {};
            if(!data[time]) data[time] = { name: '', phone: '', status: 'pending' };
            data[time][field] = value;
            localStorage.setItem(key, JSON.stringify(data));
            if(field === 'name') renderSchedule();
            showToast();
        }

        async function pickContact(time) {
            try {
                const props = ['name', 'tel'];
                const opts = { multiple: false };
                const contact = await navigator.contacts.select(props, opts);
                if (contact.length) {
                    const name = contact[0].name[0];
                    const phone = contact[0].tel[0].replace(/\s+/g, '');
                    saveSlot(time, 'name', name);
                    saveSlot(time, 'phone', phone);
                    renderSchedule();
                }
            } catch (err) {
                alert("×¡× ×›×¨×•×Ÿ ×× ×©×™ ×§×©×¨ × ×ª××š ×¨×§ ×“×¨×š ×“×¤×“×¤×Ÿ ×›×¨×•×/×¡×¤××¨×™ ×‘××•×‘×™×™×œ ×œ××—×¨ ×”×•×¡×¤×” ×œ××¡×š ×”×‘×™×ª.");
            }
        }

        function openWhatsApp(time, name, phone) {
            const msg = encodeURIComponent(`×”×™×™ ${name}, ×ª×–×›×•×¨×ª ×œ×ª×•×¨ ×©×œ×š ××¦×œ ××•×¤×™×¨ ×‘- ${time}. ××—×›×™× ×œ×š!`);
            window.open(`https://wa.me/972${phone.substring(1)}?text=${msg}`);
        }

        function toggleStatus(time) {
            const key = getDayKey();
            let data = JSON.parse(localStorage.getItem(key)) || {};
            data[time].status = data[time].status === 'done' ? 'pending' : 'done';
            localStorage.setItem(key, JSON.stringify(data));
            renderSchedule();
        }

        function getDayKey() {
            return DB_PREFIX + document.getElementById('datePicker').value;
        }

        function changeDate(delta) {
            currentDate.setDate(currentDate.getDate() + delta);
            initApp();
        }

        function jumpToDate(val) {
            currentDate = new Date(val);
            initApp();
        }

        function toggleSettings(show) {
            document.getElementById('settingsModal').style.display = show ? 'block' : 'none';
        }

        function saveSettings() {
            config.start = parseInt(document.getElementById('setStart').value);
            config.end = parseInt(document.getElementById('setEnd').value);
            localStorage.setItem(SETTINGS_KEY, JSON.stringify(config));
            toggleSettings(false);
            renderSchedule();
        }

        function exportData() {
            const data = JSON.stringify(localStorage);
            const blob = new Blob([data], {type: 'text/plain'});
            const a = document.createElement('a');
            a.href = URL.createObjectURL(blob);
            a.download = `ofir_backup_${new Date().toLocaleDateString()}.txt`;
            a.click();
        }

        function showToast() {
            const t = document.getElementById('toast');
            t.style.display = 'block';
            setTimeout(() => t.style.display = 'none', 2000);
        }

        // Register Service Worker for PWA
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('data:application/javascript,self.addEventListener("fetch", function(e){})');
        }
    </script>
</body>
</html>
