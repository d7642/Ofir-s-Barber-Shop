<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>OFIR - Pro Barber</title>
    
    <link rel="manifest" href="data:application/manifest+json,{'name':'OfirBarber','short_name':'Ofir','start_url':'.','display':'standalone','background_color':'#0f0f10','theme_color':'#C6A87C'}">

    <style>
        :root {
            --bg-dark: #0f0f10;
            --card-dark: #1a1a1c;
            --gold: #C6A87C;
            --text-main: #ffffff;
            --text-muted: #888888;
            --border-color: #333;
            --success: #28a745;
            --danger: #ff4444;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; font-family: 'Segoe UI', system-ui, sans-serif; }

        body {
            background-color: var(--bg-dark);
            color: var(--text-main);
            margin: 0;
            padding-bottom: 80px;
            direction: rtl;
        }

        header {
            padding: 20px;
            text-align: center;
            background: rgba(0,0,0,0.9);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid var(--border-color);
            position: sticky; top: 0; z-index: 1000;
        }

        .brand-name { font-family: serif; font-size: 1.8rem; letter-spacing: 3px; margin: 0; }
        .brand-sub { font-size: 0.7rem; color: var(--gold); letter-spacing: 4px; text-transform: uppercase; }

        .calendar-strip {
            background: var(--card-dark);
            padding: 15px;
            display: flex;
            flex-direction: column;
            align-items: center;
            border-bottom: 1px solid var(--border-color);
        }

        .calendar-header {
            display: flex; align-items: center; gap: 20px; margin-bottom: 10px; width: 100%; justify-content: space-between;
        }

        #currentMonthDisplay { font-weight: bold; color: var(--gold); font-size: 1.1rem; }

        input[type="date"] {
            background: #222; color: #fff; border: 1px solid var(--gold);
            padding: 8px; border-radius: 8px; font-size: 1rem; width: 100%; max-width: 200px;
        }

        .schedule-container { padding: 10px; max-width: 600px; margin: 0 auto; }

        .slot-card {
            background: var(--card-dark);
            border-radius: 15px;
            margin-bottom: 12px;
            padding: 12px;
            display: flex;
            flex-direction: column;
            border-right: 4px solid #333;
            transition: 0.3s;
        }

        .slot-card.has-client { border-right-color: var(--gold); }
        .slot-card.completed { border-right-color: var(--success); opacity: 0.6; }

        .slot-top { display: flex; align-items: center; gap: 10px; }
        .slot-time { font-weight: 800; color: var(--gold); font-size: 1.1rem; min-width: 55px; }

        .inputs-area { flex-grow: 1; display: flex; flex-direction: column; gap: 4px; }
        
        .input-name, .input-phone {
            background: transparent; border: none; color: #fff; font-size: 1rem; width: 100%;
            padding: 2px 0; border-bottom: 1px solid transparent;
        }
        .input-phone { font-size: 0.85rem; color: var(--text-muted); }
        .input-name:focus, .input-phone:focus { border-bottom-color: var(--gold); outline: none; }

        .actions { display: flex; gap: 6px; align-items: center; flex-wrap: wrap; justify-content: flex-end; }
        
        .btn-action {
            background: #252527; border: 1px solid #444; color: var(--gold);
            width: 38px; height: 38px; border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            font-size: 1.1rem; text-decoration: none; cursor: pointer;
        }
        .btn-delete { color: var(--danger); }

        .bottom-nav {
            position: fixed; bottom: 0; left: 0; right: 0;
            background: rgba(20,20,22,0.95); backdrop-filter: blur(15px);
            display: flex; justify-content: space-around; padding: 12px;
            border-top: 1px solid var(--border-color); z-index: 1000;
        }

        .nav-item { color: var(--text-muted); text-align: center; font-size: 0.75rem; cursor: pointer; }
        .nav-item.active { color: var(--gold); }

        #settingsModal {
            position: fixed; inset: 0; background: rgba(0,0,0,0.9);
            display: none; z-index: 2000; padding: 40px 20px;
        }

        .modal-content { background: var(--card-dark); padding: 25px; border-radius: 20px; border: 1px solid var(--gold); max-width: 400px; margin: auto; }

        #toast {
            position: fixed; bottom: 100px; left: 50%; transform: translateX(-50%);
            background: var(--gold); color: #000; padding: 10px 25px;
            border-radius: 20px; font-weight: bold; display: none; z-index: 3000;
        }
    </style>
</head>
<body>

    <header>
        <h1 class="brand-name">OFIR</h1>
        <div class="brand-sub">Master Barber</div>
    </header>

    <div class="calendar-strip">
        <div class="calendar-header">
            <button class="btn-action" onclick="changeDate(-1)">â®</button>
            <div id="currentMonthDisplay">×˜×•×¢×Ÿ...</div>
            <button class="btn-action" onclick="changeDate(1)">â¯</button>
        </div>
        <input type="date" id="datePicker" onchange="jumpToDate(this.value)">
    </div>

    <div class="schedule-container" id="schedule"></div>

    <div class="bottom-nav">
        <div class="nav-item active" onclick="location.reload()">ğŸ <br>×‘×™×ª</div>
        <div class="nav-item" onclick="toggleSettings(true)">âš™ï¸<br>×”×’×“×¨×•×ª</div>
        <div class="nav-item" onclick="exportData()">ğŸ’¾<br>×’×™×‘×•×™</div>
    </div>

    <div id="settingsModal">
        <div class="modal-content">
            <h3 style="margin-top:0">×”×’×“×¨×•×ª ×™×•× ×¢×‘×•×“×”</h3>
            <p style="font-size:0.8rem; color:var(--gold)">×¢×‘×•×¨ ×—×¦×•×ª, ×¨×©×•× 24</p>
            <label>×©×¢×ª ×”×ª×—×œ×”:</label>
            <input type="number" id="setStart" min="0" max="23" style="width:100%; padding:10px; margin:10px 0; background:#222; color:#fff; border:1px solid #444; border-radius:8px;">
            <label>×©×¢×ª ×¡×™×•×:</label>
            <input type="number" id="setEnd" min="1" max="24" style="width:100%; padding:10px; margin:10px 0; background:#222; color:#fff; border:1px solid #444; border-radius:8px;">
            <br><br>
            <button onclick="saveSettings()" style="background:var(--gold); border:none; padding:12px; width:100%; border-radius:10px; font-weight:bold; cursor:pointer;">×©××•×¨ ×©×™× ×•×™×™×</button>
            <button onclick="toggleSettings(false)" style="background:transparent; color:#fff; border:none; padding:10px; width:100%; margin-top:10px; cursor:pointer;">×‘×™×˜×•×œ</button>
        </div>
    </div>

    <div id="toast">× ×©××¨! âœ“</div>

    <script>
        let currentDate = new Date();
        const DB_PREFIX = "ofir_v3_";
        const SETTINGS_KEY = "ofir_cfg";

        let config = JSON.parse(localStorage.getItem(SETTINGS_KEY)) || { start: 9, end: 24 };

        function initApp() {
            updateDateUI();
            renderSchedule();
            // Update settings inputs with current values
            document.getElementById('setStart').value = config.start;
            document.getElementById('setEnd').value = config.end;
        }

        function updateDateUI() {
            const options = { weekday: 'long', day: 'numeric', month: 'long' };
            document.getElementById('currentMonthDisplay').innerText = currentDate.toLocaleDateString('he-IL', options);
            
            const yyyy = currentDate.getFullYear();
            const mm = String(currentDate.getMonth() + 1).padStart(2, '0');
            const dd = String(currentDate.getDate()).padStart(2, '0');
            document.getElementById('datePicker').value = `${yyyy}-${mm}-${dd}`;
        }

        function renderSchedule() {
            const container = document.getElementById('schedule');
            container.innerHTML = '';
            const dayKey = DB_PREFIX + document.getElementById('datePicker').value;
            const dayData = JSON.parse(localStorage.getItem(dayKey)) || {};

            for (let h = config.start; h < config.end; h++) {
                for (let m of ['00', '15', '30', '45']) {
                    const displayH = h === 24 ? '00' : String(h % 24).padStart(2, '0');
                    const time = `${displayH}:${m}`;
                    const entry = dayData[time] || { name: '', phone: '', status: 'pending' };
                    const hasData = entry.name || entry.phone;
                    
                    const card = document.createElement('div');
                    card.className = `slot-card ${entry.name ? 'has-client' : ''} ${entry.status === 'done' ? 'completed' : ''}`;
                    
                    card.innerHTML = `
                        <div class="slot-top">
                            <div class="slot-time">${time}</div>
                            <div class="inputs-area">
                                <input type="text" class="input-name" placeholder="×©× ×”×œ×§×•×—" value="${entry.name}" onchange="saveSlot('${time}', 'name', this.value)">
                                <input type="tel" class="input-phone" placeholder="×˜×œ×¤×•×Ÿ" value="${entry.phone}" onchange="saveSlot('${time}', 'phone', this.value)">
                            </div>
                            <div class="actions">
                                <button class="btn-action" onclick="pickContact('${time}')" title="×× ×©×™ ×§×©×¨">ğŸ‘¤</button>
                                ${entry.phone ? `<a href="tel:${entry.phone}" class="btn-action">ğŸ“</a>` : ''}
                                ${entry.phone ? `<button class="btn-action" onclick="openWhatsApp('${time}', '${entry.name}', '${entry.phone}')">ğŸ’¬</button>` : ''}
                                <button class="btn-action" onclick="toggleStatus('${time}')">${entry.status === 'done' ? 'âœ…' : 'âœ‚'}</button>
                                ${hasData ? `<button class="btn-action btn-delete" onclick="deleteSlot('${time}')" title="××—×§">ğŸ—‘ï¸</button>` : ''}
                            </div>
                        </div>
                    `;
                    container.appendChild(card);
                }
            }
        }

        function saveSlot(time, field, value) {
            const key = DB_PREFIX + document.getElementById('datePicker').value;
            let data = JSON.parse(localStorage.getItem(key)) || {};
            if(!data[time]) data[time] = { name: '', phone: '', status: 'pending' };
            data[time][field] = value.trim();
            localStorage.setItem(key, JSON.stringify(data));
            if(field === 'phone' || field === 'name') renderSchedule();
            showToast();
        }

        function deleteSlot(time) {
            if(confirm('×œ××—×•×§ ××ª ×”×ª×•×¨ ×‘-' + time + '?')) {
                const key = DB_PREFIX + document.getElementById('datePicker').value;
                let data = JSON.parse(localStorage.getItem(key)) || {};
                delete data[time];
                localStorage.setItem(key, JSON.stringify(data));
                renderSchedule();
                showToast("× ××—×§!");
            }
        }

        async function pickContact(time) {
            try {
                if (!('contacts' in navigator && 'select' in navigator.contacts)) throw new Error();
                const contact = await navigator.contacts.select(['name', 'tel'], { multiple: false });
                if (contact.length) {
                    const name = contact[0].name[0];
                    const phone = contact[0].tel[0].replace(/[^0-9+]/g, '');
                    saveSlot(time, 'name', name);
                    saveSlot(time, 'phone', phone);
                }
            } catch (err) {
                alert("×œ×™×™×‘×•× ×× ×©×™ ×§×©×¨: ×¤×ª×— ×‘×¡×¤××¨×™ -> ×©×ª×£ -> ×”×•×¡×£ ×œ××¡×š ×”×‘×™×ª.");
            }
        }

        function openWhatsApp(time, name, phone) {
            const cleanPhone = phone.startsWith('0') ? '972' + phone.substring(1) : phone;
            const msg = encodeURIComponent(`×”×™×™ ${name}, ×ª×–×›×•×¨×ª ×œ×ª×•×¨ ×©×œ×š ××¦×œ ××•×¤×™×¨ ×‘×©×¢×” ${time}. ××—×›×™× ×œ×š!`);
            window.open(`https://wa.me/${cleanPhone.replace('+', '')}?text=${msg}`);
        }

        function toggleStatus(time) {
            const key = DB_PREFIX + document.getElementById('datePicker').value;
            let data = JSON.parse(localStorage.getItem(key)) || {};
            if(!data[time]) return;
            data[time].status = data[time].status === 'done' ? 'pending' : 'done';
            localStorage.setItem(key, JSON.stringify(data));
            renderSchedule();
        }

        function changeDate(delta) {
            currentDate.setDate(currentDate.getDate() + delta);
            initApp();
        }

        function jumpToDate(val) {
            currentDate = new Date(val);
            initApp();
        }

        function toggleSettings(show) {
            document.getElementById('settingsModal').style.display = show ? 'block' : 'none';
        }

        function saveSettings() {
            let s = parseInt(document.getElementById('setStart').value);
            let e = parseInt(document.getElementById('setEnd').value);
            
            if (e <= s && e !== 0) {
                alert("×©×¢×ª ×”×¡×™×•× ×—×™×™×‘×ª ×œ×”×™×•×ª ××—×¨×™ ×©×¢×ª ×”×”×ª×—×œ×”");
                return;
            }
            
            config.start = s;
            config.end = e;
            localStorage.setItem(SETTINGS_KEY, JSON.stringify(config));
            toggleSettings(false);
            renderSchedule();
            showToast("×”×’×“×¨×•×ª ×¢×•×“×›× ×•");
        }

        function exportData() {
            const blob = new Blob([JSON.stringify(localStorage)], {type: 'text/plain'});
            const a = document.createElement('a');
            a.href = URL.createObjectURL(blob);
            a.download = `ofir_backup.txt`;
            a.click();
        }

        function showToast(txt = "× ×©××¨! âœ“") {
            const t = document.getElementById('toast');
            t.innerText = txt;
            t.style.display = 'block';
            setTimeout(() => t.style.display = 'none', 1500);
        }

        initApp();
    </script>
</body>
</html>
